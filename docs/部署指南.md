# é£ä¹¦æ—¥æŠ¥æœºå™¨äººéƒ¨ç½²æŒ‡å—

## æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | æˆæœ¬ | ç¨³å®šæ€§ | æ˜“ç”¨æ€§ | æ¨èåº¦ |
|------|------|--------|--------|--------|
| äº‘æœåŠ¡å™¨ + systemd | 30-50å…ƒ/æœˆ | â­â­â­â­â­ | â­â­â­â­ | ğŸ”¥ æ¨è |
| Docker + äº‘å¹³å° | 30-50å…ƒ/æœˆ | â­â­â­â­â­ | â­â­â­â­â­ | ğŸ”¥ æ¨è |
| æœ¬åœ° + screen/nohup | å…è´¹ | â­â­ | â­â­â­ | ä¸æ¨è |
| Serverless | æŒ‰é‡è®¡è´¹ | â­â­â­â­ | â­â­ | é«˜çº§ |

---

## æ–¹æ¡ˆ1ï¼šäº‘æœåŠ¡å™¨éƒ¨ç½²ï¼ˆæ¨èï¼‰

### 1.1 è´­ä¹°äº‘æœåŠ¡å™¨

**é˜¿é‡Œäº‘è½»é‡åº”ç”¨æœåŠ¡å™¨**ï¼ˆæ¨èæ–°ç”¨æˆ·ä¼˜æƒ ï¼‰
- é…ç½®ï¼š1æ ¸2G
- ç³»ç»Ÿï¼šUbuntu 20.04/22.04
- å¸¦å®½ï¼š1-3Mbps
- ä»·æ ¼ï¼šçº¦40å…ƒ/æœˆ
- åœ°åŸŸï¼šé€‰æ‹©ç¦»ä½ è¿‘çš„

**å…¶ä»–é€‰æ‹©**
- è…¾è®¯äº‘è½»é‡æœåŠ¡å™¨
- åä¸ºäº‘ ECS
- AWS Lightsail

### 1.2 éƒ¨ç½²æ­¥éª¤

#### æ­¥éª¤1ï¼šä¸Šä¼ ä»£ç 

```bash
# æœ¬åœ°æ‰“åŒ…
cd /Users/ts
tar -czf feishu_bot.tar.gz feishu_bot_mailer/

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp feishu_bot.tar.gz root@your_server_ip:/opt/

# SSH ç™»å½•æœåŠ¡å™¨
ssh root@your_server_ip
```

#### æ­¥éª¤2ï¼šæœåŠ¡å™¨ç¯å¢ƒé…ç½®

```bash
# è§£å‹ä»£ç 
cd /opt
tar -xzf feishu_bot.tar.gz
cd feishu_bot_mailer

# å®‰è£… Python3 å’Œ pip
apt update
apt install -y python3 python3-pip

# å®‰è£…ä¾èµ–
pip3 install -r requirements.txt

# é…ç½® .envï¼ˆå¤åˆ¶ä½ çš„æœ¬åœ°é…ç½®ï¼‰
nano .env
```

#### æ­¥éª¤3ï¼šé…ç½® systemd å®ˆæŠ¤è¿›ç¨‹

åˆ›å»ºæœåŠ¡æ–‡ä»¶ï¼š
```bash
nano /etc/systemd/system/feishu-bot.service
```

å†…å®¹ï¼š
```ini
[Unit]
Description=Feishu Bot Daily Report Service
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/opt/feishu_bot_mailer
ExecStart=/usr/bin/python3 /opt/feishu_bot_mailer/app_ws.py
Restart=always
RestartSec=10
StandardOutput=append:/opt/feishu_bot_mailer/logs/bot.log
StandardError=append:/opt/feishu_bot_mailer/logs/bot.log
Environment="PYTHONUNBUFFERED=1"

[Install]
WantedBy=multi-user.target
```

#### æ­¥éª¤4ï¼šå¯åŠ¨æœåŠ¡

```bash
# é‡è½½é…ç½®
systemctl daemon-reload

# è®¾ç½®å¼€æœºè‡ªå¯
systemctl enable feishu-bot

# å¯åŠ¨æœåŠ¡
systemctl start feishu-bot

# æŸ¥çœ‹çŠ¶æ€
systemctl status feishu-bot

# æŸ¥çœ‹æ—¥å¿—
tail -f /opt/feishu_bot_mailer/logs/bot.log
```

#### å¸¸ç”¨å‘½ä»¤

```bash
# åœæ­¢æœåŠ¡
systemctl stop feishu-bot

# é‡å¯æœåŠ¡
systemctl restart feishu-bot

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl status feishu-bot

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
journalctl -u feishu-bot -f

# æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿—
journalctl -u feishu-bot -n 100
```

---

## æ–¹æ¡ˆ2ï¼šDocker éƒ¨ç½²

### 2.1 æœ¬åœ°æµ‹è¯•

```bash
# æ„å»ºé•œåƒ
docker-compose build

# å¯åŠ¨å®¹å™¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢å®¹å™¨
docker-compose down
```

### 2.2 äº‘æœåŠ¡å™¨éƒ¨ç½²

```bash
# 1. å®‰è£… Docker
curl -fsSL https://get.docker.com | bash
systemctl start docker
systemctl enable docker

# 2. å®‰è£… Docker Compose
curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose

# 3. ä¸Šä¼ ä»£ç 
scp -r feishu_bot_mailer root@your_server_ip:/opt/

# 4. å¯åŠ¨æœåŠ¡
cd /opt/feishu_bot_mailer
docker-compose up -d

# 5. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### 2.3 Docker å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# é‡å¯æœåŠ¡
docker-compose restart

# åœæ­¢æœåŠ¡
docker-compose stop

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# è¿›å…¥å®¹å™¨
docker-compose exec feishu-bot bash

# æ›´æ–°ä»£ç 
git pull  # æˆ–ä¸Šä¼ æ–°ä»£ç 
docker-compose down
docker-compose build
docker-compose up -d
```

---

## æ–¹æ¡ˆ3ï¼šæœ¬åœ°æŒç»­è¿è¡Œï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰

å¦‚æœæš‚æ—¶æ²¡æœ‰äº‘æœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸´æ—¶æ–¹æ¡ˆï¼š

### 3.1 ä½¿ç”¨ screenï¼ˆLinux/Macï¼‰

```bash
# å®‰è£… screen
brew install screen  # Mac
# æˆ–
apt install screen   # Linux

# å¯åŠ¨ screen ä¼šè¯
screen -S feishu-bot

# è¿è¡ŒæœåŠ¡
cd /Users/ts/feishu_bot_mailer
python3 app_ws.py

# æŒ‰ Ctrl+Aï¼Œç„¶åæŒ‰ D åˆ†ç¦»ä¼šè¯

# é‡æ–°è¿æ¥
screen -r feishu-bot

# æŸ¥çœ‹æ‰€æœ‰ä¼šè¯
screen -ls

# å…³é—­ä¼šè¯
screen -S feishu-bot -X quit
```

### 3.2 ä½¿ç”¨ nohup

```bash
cd /Users/ts/feishu_bot_mailer

# åå°è¿è¡Œ
nohup python3 app_ws.py > logs/bot.log 2>&1 &

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep app_ws.py

# åœæ­¢æœåŠ¡
pkill -f app_ws.py
```

### 3.3 Mac ç³»ç»Ÿä½¿ç”¨ launchd

åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š
```bash
nano ~/Library/LaunchAgents/com.feishu.bot.plist
```

å†…å®¹ï¼š
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>com.feishu.bot</string>
    <key>ProgramArguments</key>
    <array>
        <string>/usr/local/bin/python3</string>
        <string>/Users/ts/feishu_bot_mailer/app_ws.py</string>
    </array>
    <key>WorkingDirectory</key>
    <string>/Users/ts/feishu_bot_mailer</string>
    <key>RunAtLoad</key>
    <true/>
    <key>KeepAlive</key>
    <true/>
    <key>StandardOutPath</key>
    <string>/Users/ts/feishu_bot_mailer/logs/bot.log</string>
    <key>StandardErrorPath</key>
    <string>/Users/ts/feishu_bot_mailer/logs/bot.log</string>
</dict>
</plist>
```

å¯åŠ¨ï¼š
```bash
# åŠ è½½æœåŠ¡
launchctl load ~/Library/LaunchAgents/com.feishu.bot.plist

# å¸è½½æœåŠ¡
launchctl unload ~/Library/LaunchAgents/com.feishu.bot.plist

# æŸ¥çœ‹çŠ¶æ€
launchctl list | grep feishu
```

---

## æ–¹æ¡ˆ4ï¼šServerless éƒ¨ç½²ï¼ˆé«˜çº§ï¼‰

### é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—

**ä¼˜åŠ¿**ï¼š
- æŒ‰é‡è®¡è´¹ï¼Œä½æˆæœ¬
- è‡ªåŠ¨ä¼¸ç¼©
- å…è¿ç»´

**é™åˆ¶**ï¼š
- WebSocket é•¿è¿æ¥ä¸é€‚ç”¨
- éœ€è¦æ”¹é€ ä¸º Webhook æ¨¡å¼

**æ­¥éª¤**ï¼š
1. ä¿®æ”¹ä¸ºä½¿ç”¨ `app.py`ï¼ˆWebhook æ¨¡å¼ï¼‰
2. éƒ¨ç½²åˆ°é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—
3. é…ç½®é£ä¹¦å›è°ƒåœ°å€

---

## ç›‘æ§å’Œç»´æŠ¤

### 1. æ—¥å¿—ç›‘æ§

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f logs/bot.log

# æœç´¢é”™è¯¯
grep "ERROR" logs/bot.log

# æŒ‰æ—¶é—´æŸ¥çœ‹
grep "2025-10-22" logs/bot.log
```

### 2. è¿›ç¨‹ç›‘æ§

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl status feishu-bot

# æˆ– Docker
docker-compose ps
```

### 3. è‡ªåŠ¨å‘Šè­¦ï¼ˆå¯é€‰ï¼‰

å¯ä»¥é…ç½®ï¼š
- é˜¿é‡Œäº‘ç›‘æ§
- Prometheus + Grafana
- ç®€å•çš„ cron å¥åº·æ£€æŸ¥è„šæœ¬

---

## æˆæœ¬å¯¹æ¯”

### äº‘æœåŠ¡å™¨ï¼ˆæ¨èï¼‰
- **æœˆè´¹**ï¼š30-50å…ƒ
- **ç¨³å®šæ€§**ï¼šâ­â­â­â­â­
- **ç»´æŠ¤æˆæœ¬**ï¼šä½
- **é€‚ç”¨åœºæ™¯**ï¼šç”Ÿäº§ç¯å¢ƒ

### æœ¬åœ°è¿è¡Œ
- **æœˆè´¹**ï¼š0å…ƒ
- **ç¨³å®šæ€§**ï¼šâ­â­
- **ç”µè´¹**ï¼šçº¦10-30å…ƒ/æœˆï¼ˆ24å°æ—¶å¼€æœºï¼‰
- **é™åˆ¶**ï¼š
  - æ–­ç”µ/æ–­ç½‘æœåŠ¡åœæ­¢
  - è®¾å¤‡å…³æœºæœåŠ¡åœæ­¢
  - éœ€è¦å†…ç½‘ç©¿é€ï¼ˆå¦‚ä½¿ç”¨æœ¬åœ°IPï¼‰

### æ¨èæ–¹æ¡ˆ

**å°å›¢é˜Ÿ/ä¸ªäººä½¿ç”¨**ï¼š
- äº‘æœåŠ¡å™¨ + systemdï¼ˆæœ€ç®€å•ç¨³å®šï¼‰

**æŠ€æœ¯å›¢é˜Ÿä½¿ç”¨**ï¼š
- Docker + äº‘æœåŠ¡å™¨ï¼ˆä¾¿äºè¿ç§»å’Œæ‰©å±•ï¼‰

**ä¸´æ—¶æµ‹è¯•**ï¼š
- æœ¬åœ° + screen/nohup

---

## å¸¸è§é—®é¢˜

### Q1: æœåŠ¡çªç„¶åœæ­¢äº†æ€ä¹ˆåŠï¼Ÿ
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl status feishu-bot

# æŸ¥çœ‹æ—¥å¿—
journalctl -u feishu-bot -n 100

# é‡å¯æœåŠ¡
systemctl restart feishu-bot
```

### Q2: å¦‚ä½•æ›´æ–°ä»£ç ï¼Ÿ
```bash
# åœæ­¢æœåŠ¡
systemctl stop feishu-bot

# æ›´æ–°ä»£ç 
cd /opt/feishu_bot_mailer
git pull  # æˆ–ä¸Šä¼ æ–°æ–‡ä»¶

# é‡å¯æœåŠ¡
systemctl start feishu-bot
```

### Q3: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ
```bash
# å¤‡ä»½é…ç½®å’Œæ•°æ®
tar -czf backup_$(date +%Y%m%d).tar.gz \
    .env \
    config/ \
    data/

# ä¸‹è½½åˆ°æœ¬åœ°
scp root@server_ip:/opt/feishu_bot_mailer/backup_*.tar.gz ./
```

---

## æ¨èé…ç½®

**ç”Ÿäº§ç¯å¢ƒæ¨è**ï¼š
```
äº‘æœåŠ¡å™¨: é˜¿é‡Œäº‘è½»é‡æœåŠ¡å™¨ 1æ ¸2G
æ“ä½œç³»ç»Ÿ: Ubuntu 22.04
éƒ¨ç½²æ–¹å¼: systemd
ç›‘æ§æ–¹å¼: æ—¥å¿— + é˜¿é‡Œäº‘ç›‘æ§
å¤‡ä»½ç­–ç•¥: æ¯å‘¨å¤‡ä»½é…ç½®å’Œæ•°æ®
```

**æˆæœ¬ä¼°ç®—**ï¼š
- æœåŠ¡å™¨ï¼š40å…ƒ/æœˆ
- åŸŸåï¼ˆå¯é€‰ï¼‰ï¼š50å…ƒ/å¹´
- **æ€»è®¡ï¼šçº¦45å…ƒ/æœˆ**

æ¯”æœ¬åœ°24å°æ—¶å¼€æœºçš„ç”µè´¹è¿˜ä¾¿å®œï¼
